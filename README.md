# 通用项目模板实践

通用的 Web 开发项目模板。

## 如何使用

```shell
git clone https://github.com/whg517/fontend-practice.git -b general example
```

首先将项目克隆到本地，然后修改如下信息：

- 修改 `package.json` 中项目描述信息
- 修改 `README.md` 中的项目说明
- 删除 `.git` 目录，重新使用 `git init` 初始化。 

然后就可以做自己的开发啦。

## 项目创建说明

### 创建项目文件夹

```shell
mkdir general
```

创建 `README.md` 文件，并增加项目说明。

### 初始化 Git

为了方便版本管理，初始化 git ，并配置项目信息。

```shell
git init 
git branch -M main
git config user.name demo
git config user.email demo@example.com
```

如果你已经建好了远程仓库，可以同时将远程仓库也配置上。

```shell
git remote add origin https://github.com/example/general.git
```

创建 `.gitignore` 文件，并添加常见忽略内容。

<details>
<summary>.gitignore 文件内容</summary>

```ignorelang
### Windows template
# Windows thumbnail cache files
Thumbs.db
Thumbs.db:encryptable
ehthumbs.db
ehthumbs_vista.db

# Dump file
*.stackdump

# Folder config file
[Dd]esktop.ini

# Recycle Bin used on file shares
$RECYCLE.BIN/

# Windows Installer files
*.cab
*.msi
*.msix
*.msm
*.msp

# Windows shortcuts
*.lnk

### Linux template
*~

# temporary files which can be created if a process still has a handle open of a deleted file
.fuse_hidden*

# KDE directory preferences
.directory

# Linux trash folder which might appear on any partition or disk
.Trash-*

# .nfs files are created when an open file is removed but is still being accessed
.nfs*

### macOS template
# General
.DS_Store
.AppleDouble
.LSOverride

# Icon must end with two \r
Icon

# Thumbnails
._*

# Files that might appear in the root of a volume
.DocumentRevisions-V100
.fseventsd
.Spotlight-V100
.TemporaryItems
.Trashes
.VolumeIcon.icns
.com.apple.timemachine.donotpresent

# Directories potentially created on remote AFP share
.AppleDB
.AppleDesktop
Network Trash Folder
Temporary Items
.apdisk

### Node template
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
lerna-debug.log*

# Diagnostic reports (https://nodejs.org/api/report.html)
report.[0-9]*.[0-9]*.[0-9]*.[0-9]*.json

# Runtime data
pids
*.pid
*.seed
*.pid.lock

# Directory for instrumented libs generated by jscoverage/JSCover
lib-cov

# Coverage directory used by tools like istanbul
coverage
*.lcov

# nyc test coverage
.nyc_output

# Grunt intermediate storage (https://gruntjs.com/creating-plugins#storing-task-files)
.grunt

# Bower dependency directory (https://bower.io/)
bower_components

# node-waf configuration
.lock-wscript

# Compiled binary addons (https://nodejs.org/api/addons.html)
build/Release

# Dependency directories
node_modules/
jspm_packages/

# Snowpack dependency directory (https://snowpack.dev/)
web_modules/

# TypeScript cache
*.tsbuildinfo

# Optional npm cache directory
.npm

# Optional eslint cache
.eslintcache

# Microbundle cache
.rpt2_cache/
.rts2_cache_cjs/
.rts2_cache_es/
.rts2_cache_umd/

# Optional REPL history
.node_repl_history

# Output of 'npm pack'
*.tgz

# Yarn Integrity file
.yarn-integrity

# dotenv environment variables file
.env
.env.test

# parcel-bundler cache (https://parceljs.org/)
.cache
.parcel-cache

# Next.js build output
.next
out

# Nuxt.js build / generate output
.nuxt
dist

# Gatsby files
.cache/
# Comment in the public line in if your project uses Gatsby and not Next.js
# https://nextjs.org/blog/next-9-1#public-directory-support
# public

# vuepress build output
.vuepress/dist

# Serverless directories
.serverless/

# FuseBox cache
.fusebox/

# DynamoDB Local files
.dynamodb/

# TernJS port file
.tern-port

# Stores VSCode versions used for testing VSCode extensions
.vscode-test

# yarn v2
.yarn/cache
.yarn/unplugged
.yarn/build-state.yml
.yarn/install-state.gz
.pnp.*

.idea
.vscode
```

</details>

提交本次修改。

```shell
git add .
git commit -m "feat: Init project."
```

### 创建 npm 项目

关于 mpm 的具体用法可以参考 [npm-init](https://docs.npmjs.com/cli/v7/commands/npm-init) 文档。

```shell
npm init
```

执行上述命令会以交互式将当前目录初始化为一个 npm 包。

如果不想以交互创建，可以使用 `npm ini -y` 运行，然后手动修改项目元信息。

执行完成后会出创建一个类似如下内容的 `package.json` 文件：

```json
{
  "name": "general",
  "version": "1.0.0",
  "description": "这是一个通用项目模板",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "repository": {
    "type": "git",
    "url": "git+https://github.com/example/general.git"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "bugs": {
    "url": "https://github.com/example/general/issues"
  },
  "homepage": "https://github.com/example/general#readme"
}
```

可以根据实际需要调整文件内容，如增加作者，项目关键词等信息。

为了防止意外发布项目代码，现在需要调整该包为私有。删除 `"main"` ，增加 `"private"`

```json
{
  "name": "general",
  "version": "1.0.0",
  "description": "这是一个通用项目模板",
  "private": true,
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "repository": {
    "type": "git",
    "url": "git+https://github.com/example/general.git"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "bugs": {
    "url": "https://github.com/example/general/issues"
  },
  "homepage": "https://github.com/example/general#readme"
}
```

### 初始化 Typescript

首先[安装 typescript](https://www.typescriptlang.org/download)

```shell
npm install --save-dev typescript ts-node @types/node
```

在 `package.json` 中为 npm 注册 typescript 命令。

修改 `scripts` 节点，调整为如下内容：

```json
{
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1",
    "tsc-init": "tsc --init"
  }
}
```

然后运行 `npm run tsc-init` 初始化 typescript .

### 初始化 Webpack

首先 [安装 Webpack](https://webpack.js.org/guides/getting-started/) 。

```shell
npm install --save-dev webpack webpack-cli @types/webpack
```

创建 Webpack 的自定义配置文件 `webpack.config.ts` ：

```ts
import * as path from 'path';

const config = {
    mode: 'development',
    entry: './src/index.ts',
    output: {
        path: path.resolve(__dirname, 'dist'),
        filename: '[contenthash].bundle.js',
    },
};

export default config;
```

将 Webpack 命令注入到 npm 中：

```json
{
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1",
    "build": "webpack --mode development",
    "product": "webpack --mode production",
    "tsc-init": "tsc --init"
  }
}
```

在配置文件中指定了 Webpack 的编译入口和输出结果。根据配置，创建入口文件：

```shell
mkdir ./src
touch ./src/index.ts
```

运行命令 `npm run build` ，进行构建，可以看到如下输出：

```text
❯ npm run build

> general@1.0.0 build /home/▓▓▓▓▓/▓▓▓▓▓▓▓/general
> webpack --mode development

asset main.js 1.18 KiB [compared for emit] (name: main)
./src/index.ts 1 bytes [built] [code generated]
webpack 5.35.1 compiled successfully in 68 ms
```

#### 优化 Webpack 配置

Webpack 支持多种细颗粒度的自定义配置，能对编写的项目进行优化。

###### 样式优化

安装 loader:

```shell
npm install --save-dev style-loader css-loader
```

在 `webpack.config.ts` 的 `config` 对象中增加  `module.rules` ：

```ts
module: {
    rules: [
        {
            test: /\.css$/i,
            use: ['style-loader', 'css-loader'],
        },
        {
            test: /\.(png|svg|jpg|jpeg|gif)$/i,
            type: 'asset/resource'
        },
        {
            test: /\.(woff|woff2|eot|ttf|otf)$/i,
            type: 'asset/resource',
        },
    ]
}
```

##### 功能插件

**HtmlWebpackPlugin**

[HtmlWebpackPlugin](https://webpack.js.org/plugins/html-webpack-plugin/) 简化了 HTML 文件的创建。该插件会自动创建一个包含 Webpack 打包后的资源文件应用的
HTML 文件。

安装：

```shell
npm install --save-dev html-webpack-plugin
```

在 `webpack.config.ts` 中导入：

```ts
import HtmlWebpackPlugin from 'html-webpack-plugin';
```

在 `webpack.config.ts` 的 `config` 对象中增加 `plugins` ：

```ts
plugins: [
    new HtmlWebpackPlugin()
]
```

**CleanWebpackPlugin**

[CleanWebpackPlugin](https://github.com/johnagan/clean-webpack-plugin) 会自动在每次构建前清理 构建输出目录中的内容。

安装：

```shell
npm install --save-dev clean-webpack-plugin
```

在 `webpack.config.ts` 中导入：

```ts
import {CleanWebpackPlugin} from 'clean-webpack-plugin';
```

在 `webpack.config.ts` 的 `config` 对象中增加 `plugins` ：

```ts
plugins: [
    new CleanWebpackPlugin(),
]
```

**WebpackDevServer**

[DevServer](https://webpack.js.org/configuration/dev-server/) 能为应用提供一个快速的开发服务器， 方便测试。

```shell
npm install --save-dev webpack-dev-server @types/webpack-dev-server
```

在 `webpack.config.ts` 的 `config` 对象中增加 `devServer` ：

```ts
devServer: {
    contentBase: './dist'
}
```

将启动命令注册到 npm 中：

在 `package.json` 中的 `scripts` 中增加：

```json
{
  "start": "webpack serve --open"
}
```

##### 优化控制台输出

在 `webpack.config.ts` 的 `config` 对象中增加  `stats` 通过细粒度参数控制输出状态信息。

```ts
    stats: {
        all: false,
        assets: true,
        modules: false,
        entrypoints: false,
        children: false,
        warnings: true,
        errors: true,
    }
```

##### 打包优化

在 `webpack.config.ts` 的 `config` 对象中增加 `optimization` ：

```ts
    optimization: {
      moduleIds: 'hashed',
      // https://webpack.docschina.org/configuration/optimization/#optimizationsplitchunks
      // 分离代码
      splitChunks: {
        // 提取公共包
        cacheGroups: {
          vendor: {
            test: /[\\/]node_modules[\\/]/,
            name: 'vendors',
            chunks: 'all',
          },
        },
      },
      // https://webpack.docschina.org/configuration/optimization/#optimizationruntimechunk
      // 将入口添加到单个文件中
      runtimeChunk: 'single',
    },
```

### 增加业务代码

在 `./src/index.ts`  增加代码：

```ts
const App = () => {
    const root = document.createElement('div')
    root.textContent = 'Hello world !'
    return root
}

document.body.appendChild(App())
```

### 启动开发服务器

运行开发服务器

```shell
npm run start
```

你可以看到类似如下输出：

```text
❯ npm run start

> general@1.0.0 start //home/▓▓▓▓▓/▓▓▓▓▓▓▓/general
> webpack serve --open

ℹ ｢wds｣: Project is running at http://localhost:8080/
ℹ ｢wds｣: webpack output is served from /
ℹ ｢wds｣: Content not from webpack is served from ./dist
ℹ ｢wdm｣: wait until bundle finished: /
ℹ ｢wdm｣: asset 7a4a88085f1904342563.bundle.js 344 KiB [emitted] [immutable] (name: vendors) (id hint: vendor) 1 related asset
asset 068de44dfc3202c6ba05.bundle.js 5.6 KiB [emitted] [immutable] (name: runtime) 1 related asset
asset 7988d379687251de617b.bundle.js 1.58 KiB [emitted] [immutable] (name: main) 1 related asset
asset index.html 374 bytes [emitted]
ℹ ｢wdm｣: Compiled successfully.

```

在浏览器中打开 [http://localhost:8080/](http://localhost:8080/) 即可访问已开发的页面。

### 完整配置：

**webpack.config.ts**

```ts
import * as path from 'path';

import {CleanWebpackPlugin} from 'clean-webpack-plugin';
import HtmlWebpackPlugin from 'html-webpack-plugin';

const config = {
    mode: 'development',
    entry: './src/index.ts',
    output: {
        path: path.resolve(__dirname, 'dist'),
        filename: '[contenthash].bundle.js',
    },
    module: {
        rules: [
            {
                test: /\.css$/i,
                use: ['style-loader', 'css-loader'],
            },
            {
                test: /\.(png|svg|jpg|jpeg|gif)$/i,
                type: 'asset/resource'
            },
            {
                test: /\.(woff|woff2|eot|ttf|otf)$/i,
                type: 'asset/resource',
            },
        ],
    },
    devServer: {
        contentBase: './dist'
    },
    plugins: [
        new CleanWebpackPlugin(),
        new HtmlWebpackPlugin()
    ],
    stats: {
        all: false,
        assets: true,
        modules: false,
        entrypoints: false,
        children: false,
        warnings: true,
        errors: true,
    },
    optimization: {
        moduleIds: 'deterministic',
        // https://webpack.docschina.org/configuration/optimization/#optimizationsplitchunks
        // 分离代码
        splitChunks: {
            // 提取公共包
            cacheGroups: {
                vendor: {
                    test: /[\\/]node_modules[\\/]/,
                    name: 'vendors',
                    chunks: 'all',
                },
            },
        },
        // https://webpack.docschina.org/configuration/optimization/#optimizationruntimechunk
        // 将入口添加到单个文件中
        runtimeChunk: 'single',
    },
};

export default config;
```

**tsconfig.json**

```json5
{
  "compilerOptions": {
    /* Visit https://aka.ms/tsconfig.json to read more about this file */

    /* Basic Options */
    // "incremental": true,                         /* Enable incremental compilation */
    "target": "es5",                                /* Specify ECMAScript target version: 'ES3' (default), 'ES5', 'ES2015', 'ES2016', 'ES2017', 'ES2018', 'ES2019', 'ES2020', or 'ESNEXT'. */
    "module": "commonjs",                           /* Specify module code generation: 'none', 'commonjs', 'amd', 'system', 'umd', 'es2015', 'es2020', or 'ESNext'. */
    // "lib": [],                                   /* Specify library files to be included in the compilation. */
    // "allowJs": true,                             /* Allow javascript files to be compiled. */
    // "checkJs": true,                             /* Report errors in .js files. */
    // "jsx": "preserve",                           /* Specify JSX code generation: 'preserve', 'react-native', 'react', 'react-jsx' or 'react-jsxdev'. */
    // "declaration": true,                         /* Generates corresponding '.d.ts' file. */
    // "declarationMap": true,                      /* Generates a sourcemap for each corresponding '.d.ts' file. */
    // "sourceMap": true,                           /* Generates corresponding '.map' file. */
    // "outFile": "./",                             /* Concatenate and emit output to single file. */
    // "outDir": "./",                              /* Redirect output structure to the directory. */
    // "rootDir": "./",                             /* Specify the root directory of input files. Use to control the output directory structure with --outDir. */
    // "composite": true,                           /* Enable project compilation */
    // "tsBuildInfoFile": "./",                     /* Specify file to store incremental compilation information */
    // "removeComments": true,                      /* Do not emit comments to output. */
    // "noEmit": true,                              /* Do not emit outputs. */
    // "importHelpers": true,                       /* Import emit helpers from 'tslib'. */
    // "downlevelIteration": true,                  /* Provide full support for iterables in 'for-of', spread, and destructuring when targeting 'ES5' or 'ES3'. */
    // "isolatedModules": true,                     /* Transpile each file as a separate module (similar to 'ts.transpileModule'). */

    /* Strict Type-Checking Options */
    "strict": true,                                 /* Enable all strict type-checking options. */
    // "noImplicitAny": true,                       /* Raise error on expressions and declarations with an implied 'any' type. */
    // "strictNullChecks": true,                    /* Enable strict null checks. */
    // "strictFunctionTypes": true,                 /* Enable strict checking of function types. */
    // "strictBindCallApply": true,                 /* Enable strict 'bind', 'call', and 'apply' methods on functions. */
    // "strictPropertyInitialization": true,        /* Enable strict checking of property initialization in classes. */
    // "noImplicitThis": true,                      /* Raise error on 'this' expressions with an implied 'any' type. */
    // "alwaysStrict": true,                        /* Parse in strict mode and emit "use strict" for each source file. */

    /* Additional Checks */
    // "noUnusedLocals": true,                      /* Report errors on unused locals. */
    // "noUnusedParameters": true,                  /* Report errors on unused parameters. */
    // "noImplicitReturns": true,                   /* Report error when not all code paths in function return a value. */
    // "noFallthroughCasesInSwitch": true,          /* Report errors for fallthrough cases in switch statement. */
    // "noUncheckedIndexedAccess": true,            /* Include 'undefined' in index signature results */
    // "noPropertyAccessFromIndexSignature": true,  /* Require undeclared properties from index signatures to use element accesses. */

    /* Module Resolution Options */
    // "moduleResolution": "node",                  /* Specify module resolution strategy: 'node' (Node.js) or 'classic' (TypeScript pre-1.6). */
    // "baseUrl": "./",                             /* Base directory to resolve non-absolute module names. */
    // "paths": {},                                 /* A series of entries which re-map imports to lookup locations relative to the 'baseUrl'. */
    // "rootDirs": [],                              /* List of root folders whose combined content represents the structure of the project at runtime. */
    // "typeRoots": [],                             /* List of folders to include type definitions from. */
    // "types": [],                                 /* Type declaration files to be included in compilation. */
    // "allowSyntheticDefaultImports": true,        /* Allow default imports from modules with no default export. This does not affect code emit, just typechecking. */
    "esModuleInterop": true,                        /* Enables emit interoperability between CommonJS and ES Modules via creation of namespace objects for all imports. Implies 'allowSyntheticDefaultImports'. */
    // "preserveSymlinks": true,                    /* Do not resolve the real path of symlinks. */
    // "allowUmdGlobalAccess": true,                /* Allow accessing UMD globals from modules. */

    /* Source Map Options */
    // "sourceRoot": "",                            /* Specify the location where debugger should locate TypeScript files instead of source locations. */
    // "mapRoot": "",                               /* Specify the location where debugger should locate map files instead of generated locations. */
    // "inlineSourceMap": true,                     /* Emit a single file with source maps instead of having a separate file. */
    // "inlineSources": true,                       /* Emit the source alongside the sourcemaps within a single file; requires '--inlineSourceMap' or '--sourceMap' to be set. */

    /* Experimental Options */
    // "experimentalDecorators": true,              /* Enables experimental support for ES7 decorators. */
    // "emitDecoratorMetadata": true,               /* Enables experimental support for emitting type metadata for decorators. */

    /* Advanced Options */
    "skipLibCheck": true,                           /* Skip type checking of declaration files. */
    "forceConsistentCasingInFileNames": true        /* Disallow inconsistently-cased references to the same file. */
  }
}

```

**package.json**

```json5
{
  "name": "general",
  "version": "1.0.0",
  "description": "通用的 Web 开发项目模板。",
  "private": true,
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1",
    "build": "webpack --mode development",
    "product": "webpack --mode production",
    "start": "webpack serve --open",
    "tsc-init": "tsc --init"
  },
  "repository": {
    "type": "git",
    "url": "git+https://github.com/example/general.git"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "bugs": {
    "url": "https://github.com/example/general/issues"
  },
  "homepage": "https://github.com/example/general#readme",
  "devDependencies": {
    "@types/node": "^14.14.41",
    "@types/webpack": "^5.28.0",
    "@types/webpack-dev-server": "^3.11.3",
    "clean-webpack-plugin": "^4.0.0-alpha.0",
    "html-webpack-plugin": "^5.3.1",
    "ts-node": "^9.1.1",
    "typescript": "^4.2.4",
    "webpack": "^5.35.1",
    "webpack-cli": "^4.6.0",
    "webpack-dev-server": "^3.11.2"
  }
}
```